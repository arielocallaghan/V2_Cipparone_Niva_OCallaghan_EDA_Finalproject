---
title: "Spatial_health"
author: "Ariel O'Callaghan"
date: "2022-12-09"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#get packages 

getwd()
#install.packages("tidyverse")
library(tidyverse)

#install.packages("sf")
library(sf)

#install.packages("leaflet")
library(leaflet)

#install.packages("mapview")
library(mapview)

#install.packages("leaflet")
library(leaflet)

#install.packages("lubridate")
library(lubridate)

#install.packages(dplyr)
library(dplyr)

#install.packages("ggplot2")
library(ggplot2)

library(RColorBrewer)

par(mar=c(3,4,2,2))
display.brewer.all()

#Disable on-the-fly projections - code from lab sheet 
sf::sf_use_s2(FALSE)

#read in spatial data frame and filter for Pennsylvania 

counties_sf <- st_read('./RawData/cb_2018_us_county_20m.shp')%>% 
  filter(STATEFP == 42) #42|PA|Pennsylvania|01779798

#check data frame information 
colnames(counties_sf)

st_crs(counties_sf) 

nrow(counties_sf)

#Reveal the extent of this dataset via the st_bbox() function
st_bbox(counties_sf)

#View the data
head(counties_sf)

#Plot the county data, colored by area of land in each county
mapView(counties_sf, zcol = "ALAND")

#read in health data frame to join with spatial datframe 
healthdf<- read.csv("./ProcessedData/healthdf.csv",stringsAsFactors = TRUE)

counties_sf$NAME<- as.character(counties_sf$NAME)
class(counties_sf$NAME)

healthdf$County<- as.character(healthdf$County)
class(healthdf$County)

(healthdf)

#counties_sf<- counties_sf %>% 
 # rename(NAME== County)
  

#join data sets together 
counties_sf_join <-  merge(x = counties_sf,
                           y = healthdf, 
                           by.x = "NAME", 
                           by.y = "County" )


coal<- read.csv("./ProcessedData/Coal.Clean.csv",stringsAsFactors = TRUE)


#library(tables)
#table(Health_Data_2010$NAME, Health_Data_2010$Health.Outcomes.Rank)
```
The community health data utilized in this analysis has two separate indicators. One is health outcomes representing the countyâ€™s health at that year by looking at many different indicators, including Length of life and quality of life. It weighs both values at 50%. Length of life indicators includes mortality, life expectancy, and premature death. Quality of life indicators includes physical and mental health and low birth weight. The Heath factor is a composite of indicators of health behaviors, clinical care, social and economic factors, and physical environment. (https://www.countyhealthrankings.org/explore-health-rankings/county-health-rankings-model) For this analysis, we utilized Z scores of Health outcomes and Health Factors and the ranking of these variables by county. The data range spans from 2010-2020. 
A county with a ranking of 1 is the best health, and the lowest ranking is the poorest health. A higher Z score indicates worse health for health outcomes and factors. 

A spatial analysis was utilized to display health outcomes rank and Z score by county for 2019 and 2010. 


```{r setup, include=FALSE}
#Visualizations 

#filter for 2019 only to plot
Health_Data_2019<-counties_sf_join%>%
  filter(year==2019)

#plot 2019 data
#Health.z.2019
mapview(Health_Data_2019, 
        zcol = 'Health.Outcomes.Z.Score', 
        col.regions = brewer.pal(10,'OrRd'))

#Heath.rank2019
mapview(Health_Data_2019, 
        zcol = 'Health.Outcomes.Rank', 
        col.regions = brewer.pal(20, 'Blues'))
       
      
#plot 2010 Data
Health_Data_2010<-counties_sf_join%>%
  filter(year==2010)

#Health Z score 2010
mapview(Health_Data_2010, 
        zcol = 'Health.Outcomes.Z.Score', 
        col.regions = brewer.pal(5, 'OrRd'))

#'OrRd'
#Heath.rank2010 
mapview(Health_Data_2010, 
        zcol = 'Health.Outcomes.Rank', 
        col.regions = brewer.pal(9, 'Blues'))

#library(leafsync)
#library(latt)

#can't figure correct way to name plots to show side by side

#latticeview(Health.z.2010, Health.z.2019)
#latticeview(Heath.rank2010,Heath.rank2019)

```
The Health outcomes Rank plot for 2010 you can see the spatial distribution of ranks for that year. 2010 was choose because it is the first year of data. Out of the 20 counties that were ranked the highest only two of two of them have been coal producing counties, Indiana and Jefferson.  

The health outcomes rank plot for 2019 you can see the spatial distribution of rank for that year. In 2019 only two of the counties that had had rankings below or equal to 20 which indicates the healthiest counties had a history of coal production. These Counties were Tioga and Bedford. Two different counties then in 2010. 




